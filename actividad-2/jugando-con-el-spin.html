<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jugando con el Esp√≠n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #063833 0%, #125450 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: rgba(12, 31, 29, 0.8);
            border-radius: 20px;
            padding: 30px;
            max-width: 1200px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 255, 178, 0.2);
            color: #e0fffa;
        }

        h1 {
            text-align: center;
            color: #00FFB2;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 8px rgba(0, 255, 178, 0.5);
        }

        .subtitle {
            text-align: center;
            color: #00B7FF;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .game-board {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            align-items: start;
        }

        /* Cubo de Esp√≠n */
        .cube-section {
            text-align: center;
        }

        .cube-container {
            perspective: 800px;
            margin: 30px auto;
            width: 200px;
            height: 200px;
            position: relative;
            border: 2px solid rgba(0, 255, 178, 0.3);
            border-radius: 10px;
            background: radial-gradient(circle at center, rgba(0, 255, 178, 0.15) 0%, rgba(3, 25, 22, 0.1) 70%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 25px rgba(0, 255, 178, 0.2);
            z-index: 1;
        }

        .cube {
            width: 150px;
            height: 150px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1.2s ease;
            cursor: pointer;
            transform: rotateX(10deg) rotateY(10deg);
            z-index: 5;
        }

        /* Aplicamos efecto de brillo directamente a las caras en lugar de al cubo */
        .cube::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: transparent;
            box-shadow: 0 0 25px rgba(0, 255, 178, 0.7);
            border-radius: 5px;
            z-index: -1;
        }

        @keyframes cube-glow {
            0% {
                box-shadow: 0 0 15px rgba(0, 255, 178, 0.4);
            }

            50% {
                box-shadow: 0 0 25px rgba(0, 255, 178, 0.6);
            }

            100% {
                box-shadow: 0 0 35px rgba(0, 255, 178, 0.8);
            }
        }

        /* Estilo cuando el contenedor est√° rotando */
        .cube-container.rotating {
            animation: cube-glow 1.2s ease-in-out;
            box-shadow: 0 0 40px rgba(0, 255, 178, 0.8);
        }

        .cube-face {
            position: absolute;
            width: 100%;
            height: 100%;
            /* Bordes m√°s gruesos y brillantes */
            border: 5px solid #00FFB2;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 55px;
            font-weight: 800;
            /* Fondo m√°s oscuro para mejor contraste */
            background: rgba(0, 10, 8, 0.95);
            /* Importante: hacer las caras opacas */
            backface-visibility: hidden;
            /* Sombra interior para efecto de profundidad */
            box-shadow: inset 0 0 20px 5px rgba(0, 255, 178, 0.3);
            /* Aseguramos m√°xima opacidad */
            opacity: 1;
        }

        .cube-face.x {
            color: #00FFB2;
            text-shadow:
                0 0 10px #00FFB2,
                0 0 20px #00FFB2,
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000,
                2px 2px 0 #000;
            border-color: #00FFB2;
        }

        .cube-face.y {
            color: #00B7FF;
            text-shadow:
                0 0 10px #00B7FF,
                0 0 20px #00B7FF,
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000,
                2px 2px 0 #000;
            border-color: #00B7FF;
        }

        .cube-face.z {
            color: #00FFEA;
            text-shadow:
                0 0 10px #00FFEA,
                0 0 20px #00FFEA,
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000,
                2px 2px 0 #000;
            border-color: #00FFEA;
            /* Ligeramente m√°s grande */
            font-size: 60px;
        }

        /* Estilo para el texto de las caras */
        .face-content {
            /* Centrar perfectamente el contenido */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            /* A√±adimos un efecto de brillo para mejorar visibilidad */
            filter: brightness(1.2);
        }

        .cube-face.front {
            transform: translateZ(75px);
        }

        .cube-face.back {
            transform: rotateY(180deg) translateZ(75px);
        }

        .cube-face.right {
            transform: rotateY(90deg) translateZ(75px);
        }

        .cube-face.left {
            transform: rotateY(-90deg) translateZ(75px);
        }

        .cube-face.top {
            transform: rotateX(90deg) translateZ(75px);
        }

        .cube-face.bottom {
            transform: rotateX(-90deg) translateZ(75px);
        }

        /* Cartas */
        .cards-section {
            text-align: center;
        }

        .cards-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            min-height: 180px;
        }

        .deck {
            background: linear-gradient(135deg, #00FFB2 0%, #00B7FF 100%);
            border-radius: 15px;
            width: 120px;
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #033b35;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 255, 178, 0.3);
            /* Borde brillante para destacar el mazo */
            border: 2px solid rgba(0, 255, 178, 0.5);
        }

        .deck:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 255, 178, 0.6);
        }

        .deck:active {
            transform: translateY(0) scale(0.98);
        }

        .current-card {
            width: 120px;
            height: 180px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 72px;
            font-weight: bold;
            background: rgba(26, 69, 65, 0.8);
            border: 3px solid #00FFB2;
            transition: all 0.5s;
            animation: cardFlip 0.6s ease-out;
            color: #00B7FF;
            box-shadow: 0 10px 30px rgba(0, 255, 178, 0.3);
        }

        @keyframes cardFlip {
            0% {
                transform: rotateY(180deg) scale(0.8);
                opacity: 0;
            }

            50% {
                transform: rotateY(90deg) scale(1.1);
            }

            100% {
                transform: rotateY(0deg) scale(1);
                opacity: 1;
            }
        }

        .card-x {
            color: #00FFB2;
            background: rgba(0, 255, 178, 0.2);
        }

        .card-y {
            color: #00B7FF;
            background: rgba(0, 183, 255, 0.2);
        }

        .card-z {
            color: #00FFEA;
            background: rgba(0, 255, 234, 0.2);
        }

        .card-b {
            color: #12FF9B;
            background: rgba(18, 255, 155, 0.2);
        }

        .card-q {
            color: #7CFFE1;
            background: rgba(124, 255, 225, 0.2);
        }

        .card-r {
            color: #00E1FF;
            background: rgba(0, 225, 255, 0.2);
        }

        /* Jugadores */
        .players-section {
            background: rgba(26, 69, 65, 0.5);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 255, 178, 0.3);
        }

        .player {
            background: rgba(12, 31, 29, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .player.active {
            border-color: #00FFB2;
            box-shadow: 0 5px 15px rgba(0, 255, 178, 0.5);
            transform: scale(1.05);
        }

        .player-name {
            font-weight: bold;
            color: #00B7FF;
            margin-bottom: 5px;
        }

        .player-score {
            font-size: 24px;
            color: #00FFB2;
            font-weight: bold;
        }

        /* Contenedor para elementos de juego */
        .game-elements-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }
        
        /* Moneda */
        .coin-section {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .coin-section h4 {
            margin-bottom: 15px;
            color: #00B7FF;
        }

        .coin {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00FFB2, #00B7FF);
            border: 3px solid #00FFEA;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 255, 178, 0.5);
            color: #033b35;
        }

        .coin:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .coin.flipping {
            animation: coinFlip 1s ease-in-out;
        }

        @keyframes coinFlip {
            0% {
                transform: rotateX(0);
            }

            50% {
                transform: rotateX(1800deg);
            }

            100% {
                transform: rotateX(3600deg);
            }
        }

        /* Controles */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            margin-bottom: 15px;
        }

        button {
            background: linear-gradient(135deg, #00FFB2, #00B7FF);
            color: #033b35;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 255, 178, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Contenedor de estado del juego */
        .game-status-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        /* Info */
        .info-panel {
            background: rgba(0, 255, 178, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #00FFB2;
            animation: fadeIn 0.5s;
            border: 1px solid rgba(0, 183, 255, 0.3);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stats {
            display: flex;
            justify-content: space-around;
            padding: 12px;
            background: rgba(26, 69, 65, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 178, 0.3);
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            color: #00B7FF;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #00FFB2;
            font-size: 24px;
            font-weight: bold;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            position: relative;
            background: rgba(12, 31, 29, 0.9);
            margin: 10% auto;
            padding: 30px;
            width: 80%;
            max-width: 500px;
            border-radius: 20px;
            text-align: center;
            animation: slideIn 0.5s;
            border: 2px solid #00FFB2;
            box-shadow: 0 0 30px rgba(0, 255, 178, 0.5);
            color: #e0fffa;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .winner-text {
            font-size: 36px;
            color: #00FFB2;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0, 255, 178, 0.5);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>

<body>
    <div class="game-container">
        <div style="display: flex; justify-content: flex-end; margin-bottom: 10px;">
            <a href="../index.html"
                style="background: linear-gradient(135deg, #00FFB2, #00B7FF); color: #033b35; text-decoration: none; padding: 8px 15px; border-radius: 20px; display: flex; align-items: center; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(0,255,178,0.3);">
                <span style="margin-right: 5px;">üè†</span> Inicio
            </a>
        </div>
        <h1>üé≤ Jugando con el Esp√≠n üß≤</h1>
        <p class="subtitle">Un juego cu√°ntico para explorar las propiedades del spin</p>

        <div class="game-board">
            <div class="cube-section">
                <h3>Cubo de Esp√≠n</h3>
                <div class="cube-container">
                    <div class="cube" id="cube">
                        <div class="cube-face front z">+Z</div>
                        <div class="cube-face back z">-Z</div>
                        <div class="cube-face right x">+X</div>
                        <div class="cube-face left x">-X</div>
                        <div class="cube-face top y">+Y</div>
                        <div class="cube-face bottom y">-Y</div>
                    </div>
                </div>
                <p id="cubeState"
                    style="font-size: 22px; font-weight: bold; margin-top: 15px; color: #00FFB2; text-shadow: 0 0 8px rgba(0, 255, 178, 0.7), -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000; background-color: rgba(3, 25, 22, 0.6); padding: 8px; border-radius: 10px; display: inline-block;">
                    Estado: +Z</p>
            </div>

            <div class="cards-section">
                <h3>Cartas Magn√©ticas</h3>
                <div class="game-elements-container">
                    <div class="cards-container">
                        <div class="deck" id="deck" onclick="drawCard()">
                            <span id="cardsLeft">30</span> üìá
                        </div>
                        <div id="currentCard" style="display:none;" class="current-card"></div>
                    </div>

                    <div class="coin-section">
                        <h4>Automedidor Cu√°ntico</h4>
                        <div class="coin" id="coin" onclick="flipCoin()">?</div>
                    </div>
                </div>
            </div>

            <div class="players-section">
                <h3>Jugadores</h3>
                <div id="playersList"></div>
            </div>
        </div>

        <div class="game-status-container">
            <div class="info-panel" id="infoPanel">
                Haz clic en el mazo para sacar una carta
            </div>

            <div class="stats" id="stats">
                <div class="stat">
                    <div class="stat-label">Medidas Realizadas</div>
                    <div class="stat-value" id="measureCount">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Turno Actual</div>
                    <div class="stat-value" id="turnCount">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Direcci√≥n</div>
                    <div class="stat-value" id="direction">‚Üí</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button onclick="startNewGame()">üéÆ Nuevo Juego</button>
            <button onclick="showRules()">üìñ Reglas</button>
            <button onclick="addPlayer()">‚ûï Agregar Jugador</button>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <div id="modalBody"></div>
            <button onclick="closeModal()" style="margin-top: 20px;">Cerrar</button>
        </div>
    </div>

    <script>
        // Estado del juego
        let gameState = {
            players: [
                { name: "Jugador 1", score: 0 },
                { name: "Jugador 2", score: 0 }
            ],
            currentPlayer: 0,
            cubeState: "+Z",
            direction: 1, // 1 = derecha, -1 = izquierda
            measureCount: 0,
            turnCount: 1,
            deck: [],
            usedCards: [],
            waitingForCoin: false,
            currentCard: null,
            gameEnded: false
        };

        // Configuraci√≥n del cubo simplificada
        const cubeRotations = {
            '+Z': 'rotateX(0deg) rotateY(0deg)',
            '-Z': 'rotateX(0deg) rotateY(180deg)',
            '+X': 'rotateY(90deg)',
            '-X': 'rotateY(-90deg)',
            '+Y': 'rotateX(-90deg)',
            '-Y': 'rotateX(90deg)'
        };

        // Inicializar el juego
        function initGame() {
            createDeck();
            updateDisplay();
            renderPlayers();

            // Inicializar el cubo expl√≠citamente
            const cube = document.getElementById('cube');
            cube.style.transition = 'transform 1s ease';
            cube.style.transform = cubeRotations['+Z'];

            // Agregar evento de clic al cubo para rotarlo manualmente
            cube.addEventListener('click', () => {
                if (!gameState.waitingForCoin) {
                    randomRotateCube();
                }
            });

            // Forzar una rotaci√≥n inicial para asegurar que el cubo se muestra correctamente
            setTimeout(() => {
                randomRotateCube();
                setTimeout(() => {
                    gameState.cubeState = '+Z';
                    rotateCube();
                }, 1500);
            }, 500);
        }

        // Crear el mazo de cartas
        function createDeck() {
            gameState.deck = [];
            // Cartas X, Y, Z
            for (let i = 0; i < 8; i++) {
                gameState.deck.push('X');
                gameState.deck.push('Y');
                gameState.deck.push('Z');
            }
            // Cartas especiales
            for (let i = 0; i < 4; i++) {
                gameState.deck.push('B'); // Campo magn√©tico
                gameState.deck.push('Q'); // Quantum flip
            }
            for (let i = 0; i < 2; i++) {
                gameState.deck.push('R'); // Reversa
            }

            // Barajar
            gameState.deck = shuffleArray(gameState.deck);
        }

        // Barajar array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Sacar carta
        function drawCard() {
            if (gameState.waitingForCoin || gameState.gameEnded) return;

            let card;
            if (gameState.deck.length > 0) {
                card = gameState.deck.pop();
            } else if (gameState.usedCards.length > 0) {
                // Si se acabaron las cartas, usar las usadas
                gameState.deck = shuffleArray(gameState.usedCards);
                gameState.usedCards = [];
                card = gameState.deck.pop();
            } else {
                endGame();
                return;
            }

            gameState.currentCard = card;
            showCard(card);
            processCard(card);
        }

        // Mostrar carta
        function showCard(card) {
            const cardEl = document.getElementById('currentCard');
            cardEl.style.display = 'flex';
            cardEl.textContent = card;
            cardEl.className = 'current-card card-' + card.toLowerCase();

            // Agregar a cartas usadas
            gameState.usedCards.push(card);
        }

        // Procesar carta
        function processCard(card) {
            const player = gameState.players[gameState.currentPlayer];
            let message = `${player.name} sac√≥ ${card}. `;

            switch (card) {
                case 'X':
                case 'Y':
                    // Verificar si coincide con el estado del cubo
                    if (gameState.cubeState[1] === card) {
                        const points = gameState.cubeState[0] === '+' ? 1 : -1;
                        player.score += points;
                        message += `Estado coincide: ${points > 0 ? '+' : ''}${points} puntos`;
                        nextTurn();
                    } else {
                        gameState.waitingForCoin = true;
                        message += "Lanza el Automedidor Cu√°ntico";
                    }
                    break;

                case 'Z':
                    // Verificar si coincide con el estado del cubo
                    if (gameState.cubeState[1] === 'Z') {
                        const points = gameState.cubeState[0] === '+' ? 1 : -1;
                        player.score += points;
                        message += `Estado coincide: ${points > 0 ? '+' : ''}${points} puntos`;
                    } else {
                        player.score += 1;
                        message += "+1 punto";
                    }
                    nextTurn();
                    break;

                case 'B':
                    player.score -= 1;
                    message += "Campo magn√©tico aplicado: -1 punto. El cubo gira...";
                    randomRotateCube();
                    setTimeout(nextTurn, 1000);
                    break;

                case 'Q':
                    gameState.waitingForCoin = true;
                    message += "Quantum Flip! Lanza el Automedidor";
                    break;

                case 'R':
                    gameState.direction *= -1;
                    message += "¬°Reversa temporal! Cambia la direcci√≥n";
                    updateDisplay();
                    nextTurn();
                    break;
            }

            document.getElementById('infoPanel').textContent = message;
            updateDisplay();
        }

        // Lanzar moneda
        function flipCoin() {
            if (!gameState.waitingForCoin) return;

            const coin = document.getElementById('coin');
            coin.classList.add('flipping');

            setTimeout(() => {
                const result = Math.random() < 0.5 ? -1 : 1;
                coin.textContent = result > 0 ? '+' : '-';
                coin.classList.remove('flipping');

                processCoinResult(result);
            }, 1000);
        }

        // Procesar resultado de la moneda
        function processCoinResult(result) {
            const player = gameState.players[gameState.currentPlayer];
            const card = gameState.currentCard;

            if (card === 'Q') {
                // Quantum Flip
                player.score += result * 2;
                const newSign = result > 0 ? '+' : '-';
                const currentAxis = gameState.cubeState[1];
                gameState.cubeState = newSign + currentAxis;
                rotateCube();

                document.getElementById('infoPanel').textContent =
                    `Quantum Flip: ${result > 0 ? '+2' : '-2'} puntos. Cubo: ${gameState.cubeState}`;
            } else {
                // Medida normal
                player.score += result;
                gameState.cubeState = (result > 0 ? '+' : '-') + card;
                rotateCube();
                gameState.measureCount++;

                document.getElementById('infoPanel').textContent =
                    `Medida: ${result > 0 ? '+1' : '-1'} punto. Cubo: ${gameState.cubeState}`;
            }

            gameState.waitingForCoin = false;
            updateDisplay();

            // Verificar fin del juego
            if (gameState.measureCount >= 30) {
                setTimeout(endGame, 1500);
            } else {
                setTimeout(nextTurn, 1500);
            }
        }

        // Rotar cubo - funci√≥n simplificada
        function rotateCube() {
            const cube = document.getElementById('cube');

            // A√±adir clase para indicar que est√° rotando
            document.querySelector('.cube-container').classList.add('rotating');

            // Aplicar la transformaci√≥n b√°sica
            cube.style.transform = cubeRotations[gameState.cubeState];

            // Actualizar el estado mostrado
            document.getElementById('cubeState').textContent = `Estado: ${gameState.cubeState}`;

            // Quitar la clase despu√©s de la rotaci√≥n
            setTimeout(() => {
                document.querySelector('.cube-container').classList.remove('rotating');
            }, 1200);
        }

        // Rotaci√≥n aleatoria del cubo - simplificada
        function randomRotateCube() {
            const states = ['+X', '-X', '+Y', '-Y', '+Z', '-Z'];

            // Evitar repetir el mismo estado
            let newState;
            do {
                newState = states[Math.floor(Math.random() * states.length)];
            } while (newState === gameState.cubeState);

            gameState.cubeState = newState;

            // Hacer la rotaci√≥n m√°s lenta
            const cube = document.getElementById('cube');
            const originalTransition = cube.style.transition;
            cube.style.transition = 'transform 1.5s ease';

            // Rotar
            rotateCube();

            // Restaurar la transici√≥n original
            setTimeout(() => {
                cube.style.transition = originalTransition;
            }, 1500);
        }

        // Siguiente turno
        function nextTurn() {
            gameState.currentPlayer = (gameState.currentPlayer + gameState.direction +
                gameState.players.length) % gameState.players.length;
            gameState.turnCount++;

            // Resetear moneda
            document.getElementById('coin').textContent = '?';

            updateDisplay();
            renderPlayers();
        }

        // Actualizar display
        function updateDisplay() {
            document.getElementById('measureCount').textContent = gameState.measureCount;
            document.getElementById('turnCount').textContent = gameState.turnCount;
            document.getElementById('direction').textContent = gameState.direction > 0 ? '‚Üí' : '‚Üê';
            document.getElementById('cardsLeft').textContent = gameState.deck.length;

            renderPlayers();
        }

        // Renderizar jugadores
        function renderPlayers() {
            const container = document.getElementById('playersList');
            container.innerHTML = '';

            gameState.players.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player' + (index === gameState.currentPlayer ? ' active' : '');
                div.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-score">${player.score} pts</div>
                `;
                container.appendChild(div);
            });
        }

        // Agregar jugador
        function addPlayer() {
            if (gameState.players.length >= 4) {
                alert('M√°ximo 4 jugadores');
                return;
            }

            const name = prompt('Nombre del jugador:');
            if (name) {
                gameState.players.push({ name, score: 0 });
                renderPlayers();
            }
        }

        // Nuevo juego
        function startNewGame() {
            if (confirm('¬øIniciar un nuevo juego?')) {
                gameState.currentPlayer = 0;
                gameState.cubeState = '+Z';
                gameState.direction = 1;
                gameState.measureCount = 0;
                gameState.turnCount = 1;
                gameState.waitingForCoin = false;
                gameState.currentCard = null;
                gameState.gameEnded = false;
                gameState.usedCards = [];

                gameState.players.forEach(p => p.score = 0);

                document.getElementById('currentCard').style.display = 'none';
                document.getElementById('coin').textContent = '?';
                document.getElementById('infoPanel').textContent = 'Haz clic en el mazo para sacar una carta';

                createDeck();
                rotateCube();
                updateDisplay();
            }
        }

        // Fin del juego
        function endGame() {
            gameState.gameEnded = true;

            const winner = gameState.players.reduce((prev, current) =>
                (prev.score > current.score) ? prev : current
            );

            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div class="winner-text">üèÜ ¬°Juego Terminado! üèÜ</div>
                <h2>Ganador: ${winner.name}</h2>
                <h3>Puntuaci√≥n: ${winner.score} puntos</h3>
                <hr style="margin: 20px 0;">
                <h4>Puntuaciones Finales:</h4>
                ${gameState.players.map(p =>
                `<p>${p.name}: ${p.score} puntos</p>`
            ).join('')}
                <p style="margin-top: 20px;">Medidas realizadas: ${gameState.measureCount}</p>
            `;

            document.getElementById('modal').style.display = 'block';
        }

        // Mostrar reglas
        function showRules() {
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <h2>üìñ Reglas del Juego</h2>
                <div style="text-align: left; max-height: 400px; overflow-y: auto;">
                    <h3>Objetivo</h3>
                    <p>Acumular la mayor cantidad de puntos despu√©s de 30 medidas cu√°nticas.</p>
                    
                    <h3>Cartas y Acciones</h3>
                    <p><strong>X, Y:</strong> Si coincide con el cubo, ganas/pierdes seg√∫n el signo. Si no, lanza la moneda para medir.</p>
                    <p><strong>Z:</strong> Si coincide con el cubo, ganas/pierdes seg√∫n el signo. Si no, +1 punto directo.</p>
                    <p><strong>B (Campo Magn√©tico):</strong> -1 punto, el cubo gira aleatoriamente.</p>
                    <p><strong>Q (Quantum Flip):</strong> Lanza la moneda, ganas/pierdes el doble y el cubo cambia de signo.</p>
                    <p><strong>R (Reversa):</strong> Cambia la direcci√≥n del juego.</p>
                    
                    <h3>Automedidor Cu√°ntico (Moneda)</h3>
                    <p>+ = +1 punto | - = -1 punto</p>
                    <p>Al medir, el cubo cambia al estado medido.</p>
                    
                    <h3>Fin del Juego</h3>
                    <p>El juego termina despu√©s de 30 medidas. ¬°El jugador con m√°s puntos gana!</p>
                </div>
            `;

            document.getElementById('modal').style.display = 'block';
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Inicializar al cargar
        window.onload = initGame;
    </script>
</body>

</html>